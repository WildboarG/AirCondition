#include <ESP8266WiFi.h>
#include <ESP8266WebServer.h>
#include <ESP8266WiFi.h>       // 本程序使用 ESP8266WiFi库
#include <ESP8266WiFiMulti.h>  //  ESP8266WiFiMulti库
#include <ESP8266WebServer.h>  //  ESP8266WebServer库
#include <IRremoteESP8266.h>
#include <IRsend.h>


const char* ssid = "TP-LINK_4450";     // 需要连接到的WiFi名
const char* password = "HYGS3305";  // 连接的WiFi密码
ESP8266WebServer server(80);
IPAddress local_IP(192, 168, 0, 200);  // 设置ESP8266-NodeMCU联网后的IP
IPAddress gateway(192, 168, 0, 1);     // 设置网关IP（通常网关IP是WiFI路由IP）
IPAddress subnet(255, 255, 255, 0);    // 设置子网掩码
IPAddress dns(192, 168, 0, 1);         // 设置局域网DNS的IP（通常局域网DNS的IP是WiFI路由IP）

const uint16_t kIrLed = 14;  // ESP8266 GPIO pin to use. Recommended: 4 (D2).
IRsend irsend(kIrLed);       // Set the GPIO to be used to sending the message.
//
ESP8266WiFiMulti wifiMulti;  // 建立ESP8266WiFiMulti对象,对象名称是'wifiMulti'
const uint16_t code[15][279] = {
  { 9030, 4438, 578, 1632, 576, 552, 552, 530, 574, 1634, 574, 1634, 576, 552, 552, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 552, 552, 528, 576, 552, 552, 528, 576, 530, 574, 550, 554, 528, 574, 1656, 552, 530, 574, 528, 576, 528, 576, 528, 576, 552, 552, 552, 552, 1634, 574, 528, 576, 1634, 576, 530, 574, 526, 578, 1632, 578, 528, 628, 20204, 552, 528, 576, 528, 576, 528, 576, 550, 552, 1634, 576, 528, 576, 530, 576, 528, 574, 528, 576, 528, 576, 528, 576, 526, 578, 528, 576, 1634, 574, 528, 576, 528, 576, 552, 552, 552, 552, 552, 552, 526, 578, 526, 578, 526, 576, 530, 574, 528, 578, 526, 576, 528, 576, 526, 578, 528, 576, 528, 576, 1632, 576, 1656, 552, 528, 630, 40438, 9126, 4474, 576, 1632, 578, 528, 576, 526, 578, 1632, 578, 1632, 576, 550, 554, 528, 574, 530, 574, 528, 578, 526, 576, 528, 576, 528, 576, 552, 552, 526, 578, 528, 576, 530, 574, 552, 552, 552, 552, 526, 578, 552, 552, 530, 574, 1632, 578, 528, 576, 528, 576, 552, 552, 526, 578, 528, 576, 528, 578, 1632, 576, 1634, 576, 1634, 576, 528, 576, 530, 574, 1634, 576, 528, 656, 20180, 576, 530, 574, 528, 576, 528, 576, 528, 576, 528, 576, 530, 574, 530, 574, 552, 552, 530, 574, 530, 574, 528, 576, 552, 552, 552, 552, 528, 576, 528, 576, 552, 552, 530, 574, 530, 574, 552, 552, 528, 576, 1656, 552, 530, 574, 530, 574, 528, 576, 528, 576, 528, 576, 528, 576, 552, 552, 528, 576, 528, 576, 1656, 552, 528, 576 },           // KELVINATOR
  { 9054, 4440, 610, 1600, 608, 494, 610, 496, 608, 1602, 606, 1600, 608, 496, 610, 494, 608, 496, 608, 1602, 608, 518, 586, 496, 608, 496, 608, 494, 610, 496, 608, 494, 610, 494, 610, 494, 610, 494, 610, 496, 608, 496, 608, 496, 608, 1600, 610, 496, 608, 496, 608, 496, 608, 520, 584, 496, 608, 496, 608, 1600, 608, 496, 608, 1624, 586, 496, 608, 498, 606, 1602, 606, 494, 662, 20172, 586, 496, 608, 496, 608, 496, 608, 518, 586, 1602, 606, 494, 612, 518, 584, 496, 610, 496, 608, 496, 608, 496, 608, 494, 610, 498, 608, 1600, 608, 494, 610, 496, 608, 496, 608, 518, 586, 496, 608, 494, 610, 496, 608, 494, 610, 518, 584, 496, 608, 496, 608, 496, 608, 520, 584, 494, 610, 1624, 586, 1624, 586, 1624, 586, 496, 660, 40430, 9136, 4442, 608, 1602, 608, 496, 608, 496, 608, 1598, 610, 1602, 606, 496, 608, 496, 608, 520, 584, 1600, 608, 518, 586, 496, 608, 518, 586, 496, 608, 496, 608, 496, 608, 496, 608, 496, 608, 496, 610, 518, 586, 496, 608, 520, 584, 1600, 610, 518, 584, 496, 608, 520, 584, 520, 584, 520, 584, 496, 608, 1600, 608, 1600, 608, 1600, 610, 496, 608, 496, 608, 1624, 586, 518, 664, 20150, 606, 494, 610, 496, 608, 494, 610, 518, 586, 496, 608, 496, 608, 518, 586, 496, 608, 496, 608, 518, 586, 496, 608, 518, 584, 496, 608, 494, 610, 496, 608, 496, 608, 496, 608, 520, 584, 496, 608, 496, 608, 1602, 606, 496, 608, 498, 606, 496, 608, 496, 608, 494, 610, 496, 608, 496, 606, 1600, 608, 496, 610, 1600, 608, 520, 584 },       // KELVINATOR
  { 9052, 4440, 610, 1600, 610, 518, 586, 496, 608, 1624, 586, 1600, 608, 518, 586, 496, 608, 518, 586, 518, 586, 1600, 610, 496, 608, 494, 610, 518, 586, 494, 610, 496, 608, 494, 610, 496, 608, 518, 586, 494, 610, 496, 608, 494, 608, 1624, 584, 496, 608, 496, 608, 518, 586, 518, 586, 496, 608, 496, 608, 1600, 608, 496, 610, 1602, 606, 496, 608, 496, 608, 1600, 608, 498, 660, 20146, 610, 496, 608, 496, 608, 494, 610, 494, 610, 1598, 610, 496, 608, 496, 608, 496, 608, 518, 586, 518, 586, 496, 608, 496, 608, 496, 608, 1600, 608, 498, 606, 496, 608, 494, 610, 494, 610, 496, 608, 520, 586, 494, 610, 494, 608, 496, 608, 520, 584, 518, 586, 496, 608, 496, 608, 496, 608, 496, 608, 496, 608, 498, 606, 1624, 638, 40406, 9158, 4442, 608, 1598, 610, 496, 608, 494, 610, 1600, 610, 1598, 610, 498, 606, 496, 608, 520, 586, 518, 584, 1602, 608, 496, 608, 494, 610, 496, 608, 494, 610, 494, 610, 498, 606, 494, 610, 496, 608, 518, 586, 518, 586, 496, 608, 1600, 608, 496, 608, 494, 610, 520, 584, 494, 610, 496, 608, 496, 608, 1602, 608, 1624, 586, 1600, 608, 518, 586, 496, 608, 1602, 608, 496, 686, 20170, 586, 518, 586, 518, 586, 496, 608, 518, 586, 518, 586, 492, 612, 518, 586, 494, 610, 494, 610, 496, 608, 496, 608, 496, 610, 518, 584, 518, 586, 496, 608, 520, 584, 496, 608, 496, 608, 496, 608, 496, 608, 1624, 586, 518, 586, 496, 608, 494, 610, 496, 606, 496, 608, 496, 608, 496, 608, 498, 606, 1600, 602, 1630, 578, 502, 608 },         // KELVINATOR
  { 9030, 4440, 610, 1600, 608, 520, 584, 520, 584, 1598, 610, 1600, 608, 518, 586, 496, 608, 496, 608, 1602, 608, 1600, 608, 496, 608, 518, 586, 496, 608, 496, 608, 496, 608, 494, 610, 518, 586, 496, 608, 496, 608, 496, 608, 496, 608, 1598, 610, 520, 584, 496, 608, 494, 610, 494, 610, 496, 608, 518, 586, 1624, 586, 518, 586, 1602, 606, 496, 608, 518, 586, 1602, 600, 502, 660, 20148, 576, 528, 576, 528, 576, 528, 576, 552, 552, 1630, 578, 530, 574, 526, 578, 526, 578, 530, 574, 528, 576, 528, 602, 502, 576, 528, 576, 1634, 576, 552, 552, 528, 576, 528, 576, 552, 552, 528, 576, 530, 574, 528, 576, 552, 552, 530, 574, 526, 578, 528, 576, 528, 576, 528, 576, 552, 552, 1632, 576, 526, 578, 528, 576, 1632, 630, 40440, 9152, 4448, 576, 1634, 576, 528, 576, 528, 576, 1632, 576, 1634, 576, 528, 576, 528, 576, 528, 576, 1632, 576, 1634, 574, 530, 576, 526, 578, 528, 576, 550, 552, 528, 576, 528, 576, 552, 552, 530, 574, 528, 576, 528, 576, 526, 578, 1632, 576, 552, 552, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 1632, 576, 1634, 574, 1632, 578, 526, 576, 530, 574, 1656, 552, 526, 656, 20204, 552, 528, 576, 552, 552, 530, 574, 528, 576, 528, 576, 552, 552, 528, 576, 530, 574, 526, 578, 526, 578, 552, 552, 528, 576, 528, 576, 528, 576, 528, 576, 530, 574, 526, 578, 552, 552, 528, 576, 526, 578, 1656, 552, 528, 576, 550, 552, 530, 574, 528, 576, 552, 552, 530, 574, 528, 576, 1656, 552, 1634, 576, 1634, 576, 528, 576 },     // KELVINATOR
  { 9046, 4448, 576, 1634, 574, 528, 576, 530, 576, 1632, 576, 1634, 576, 528, 576, 528, 576, 530, 574, 530, 574, 528, 576, 1656, 552, 528, 576, 528, 576, 552, 552, 552, 552, 528, 576, 528, 576, 552, 552, 552, 552, 528, 576, 528, 576, 1656, 552, 528, 576, 528, 576, 528, 574, 528, 576, 528, 576, 552, 552, 1656, 552, 530, 574, 1634, 574, 530, 574, 528, 576, 1656, 552, 530, 628, 20180, 578, 526, 578, 528, 576, 528, 576, 528, 576, 1632, 576, 528, 576, 530, 574, 528, 576, 528, 576, 528, 576, 550, 552, 552, 552, 530, 574, 1634, 574, 528, 576, 552, 552, 530, 574, 552, 552, 526, 578, 528, 576, 528, 576, 530, 574, 528, 576, 552, 552, 528, 576, 552, 552, 530, 574, 528, 576, 528, 576, 1634, 576, 528, 576, 1656, 604, 40438, 9154, 4448, 576, 1632, 576, 530, 574, 552, 552, 1634, 574, 1632, 578, 530, 574, 528, 576, 528, 576, 550, 554, 526, 578, 1632, 578, 528, 576, 528, 574, 528, 576, 530, 574, 528, 576, 530, 574, 526, 578, 528, 576, 528, 576, 528, 576, 1632, 576, 528, 576, 528, 576, 552, 552, 552, 552, 528, 576, 530, 574, 1632, 576, 1632, 578, 1634, 574, 530, 574, 552, 552, 1656, 552, 528, 656, 20180, 576, 530, 574, 552, 552, 528, 576, 528, 576, 530, 574, 530, 574, 552, 552, 528, 576, 528, 576, 528, 576, 552, 552, 526, 578, 528, 574, 552, 554, 526, 578, 552, 552, 528, 576, 528, 576, 530, 574, 526, 578, 1656, 552, 526, 578, 552, 552, 526, 578, 530, 574, 528, 576, 528, 576, 528, 576, 530, 574, 528, 576, 530, 574, 1634, 574 },         // KELVINATOR
  { 9054, 4442, 608, 1602, 608, 494, 608, 496, 608, 1600, 608, 1624, 586, 518, 586, 518, 586, 494, 610, 1598, 610, 496, 608, 1602, 608, 520, 584, 520, 584, 518, 586, 494, 610, 518, 586, 496, 608, 520, 586, 518, 586, 496, 608, 494, 610, 1600, 610, 496, 608, 496, 608, 494, 610, 496, 608, 518, 586, 496, 608, 1600, 608, 496, 608, 1602, 608, 520, 584, 494, 610, 1602, 606, 496, 660, 20146, 610, 496, 608, 496, 608, 494, 608, 518, 586, 1600, 608, 494, 610, 518, 586, 496, 608, 518, 586, 496, 608, 494, 610, 496, 608, 496, 608, 1624, 586, 518, 586, 496, 608, 496, 608, 498, 608, 494, 608, 496, 608, 494, 610, 494, 610, 496, 608, 496, 608, 498, 606, 494, 610, 496, 608, 496, 608, 1624, 586, 1600, 608, 494, 608, 1600, 662, 40406, 9158, 4442, 608, 1602, 608, 496, 608, 496, 608, 1598, 610, 1602, 608, 496, 608, 496, 608, 518, 586, 1600, 610, 494, 610, 1600, 608, 496, 608, 496, 608, 518, 586, 494, 610, 494, 610, 498, 606, 494, 610, 496, 608, 494, 610, 518, 586, 1600, 608, 518, 586, 498, 606, 494, 610, 496, 608, 496, 608, 494, 610, 1624, 586, 1602, 608, 1600, 610, 494, 608, 496, 608, 1602, 608, 496, 686, 20148, 610, 494, 610, 496, 608, 494, 610, 496, 608, 496, 608, 494, 608, 520, 584, 496, 608, 494, 610, 496, 608, 496, 608, 518, 586, 494, 610, 496, 608, 496, 608, 494, 610, 518, 586, 494, 610, 494, 610, 496, 606, 1602, 608, 518, 584, 496, 608, 496, 608, 498, 606, 520, 584, 496, 608, 520, 584, 1600, 608, 494, 610, 496, 608, 1598, 610 },     // KELVINATOR
  { 9052, 4444, 606, 1600, 608, 494, 610, 496, 608, 1602, 608, 1600, 608, 518, 584, 496, 608, 496, 606, 496, 608, 1624, 584, 1602, 606, 498, 608, 496, 608, 496, 608, 520, 584, 496, 608, 520, 584, 496, 608, 496, 608, 496, 608, 496, 608, 1598, 610, 494, 610, 494, 608, 496, 608, 518, 584, 496, 610, 496, 608, 1602, 608, 496, 608, 1600, 608, 496, 608, 520, 584, 1600, 608, 520, 638, 20148, 608, 520, 584, 496, 608, 494, 610, 496, 608, 1624, 584, 496, 608, 494, 610, 494, 610, 494, 610, 496, 608, 494, 610, 518, 584, 496, 608, 1598, 610, 496, 608, 496, 608, 520, 584, 498, 606, 496, 608, 496, 608, 496, 608, 496, 608, 496, 608, 496, 608, 498, 606, 496, 608, 496, 608, 496, 608, 494, 610, 496, 608, 1600, 608, 1602, 660, 40406, 9160, 4464, 586, 1624, 584, 496, 608, 496, 608, 1600, 608, 1602, 606, 494, 610, 494, 610, 496, 608, 520, 584, 1602, 608, 1600, 608, 518, 586, 518, 586, 518, 586, 520, 584, 498, 606, 496, 608, 496, 608, 520, 584, 496, 608, 494, 610, 1602, 608, 498, 606, 498, 606, 496, 608, 496, 608, 496, 608, 496, 608, 1602, 608, 1624, 586, 1598, 610, 496, 608, 498, 606, 1602, 608, 496, 686, 20148, 608, 496, 608, 498, 606, 496, 608, 494, 610, 496, 608, 494, 610, 494, 610, 496, 608, 494, 608, 496, 608, 498, 606, 496, 608, 496, 608, 520, 584, 496, 608, 496, 608, 496, 608, 494, 610, 496, 608, 496, 608, 1624, 586, 494, 610, 494, 610, 496, 608, 496, 608, 496, 608, 518, 584, 520, 584, 496, 608, 1624, 584, 496, 608, 1600, 608 },      // KELVINATOR
  { 9024, 4446, 576, 1634, 574, 528, 576, 552, 552, 1656, 552, 1634, 576, 528, 574, 528, 576, 528, 576, 1656, 552, 1632, 576, 1632, 576, 528, 576, 552, 552, 552, 552, 528, 576, 528, 576, 528, 576, 552, 552, 552, 552, 552, 552, 528, 576, 1634, 576, 528, 576, 550, 552, 528, 576, 530, 574, 530, 574, 552, 552, 1634, 574, 528, 576, 1632, 576, 528, 576, 552, 552, 1656, 552, 528, 628, 20182, 576, 528, 600, 526, 552, 528, 576, 530, 600, 1608, 576, 528, 608, 496, 608, 494, 610, 518, 586, 518, 586, 496, 608, 496, 608, 518, 586, 1600, 610, 496, 608, 496, 606, 496, 610, 498, 606, 498, 606, 498, 606, 496, 608, 496, 608, 496, 608, 494, 610, 496, 608, 496, 608, 498, 606, 496, 608, 1624, 586, 518, 586, 1624, 586, 1600, 662, 40404, 9160, 4442, 608, 1602, 606, 496, 610, 494, 608, 1624, 584, 1600, 608, 496, 608, 496, 608, 494, 610, 1602, 606, 1624, 586, 1600, 608, 498, 606, 496, 608, 494, 610, 496, 608, 496, 610, 496, 606, 520, 584, 498, 606, 496, 608, 494, 610, 1624, 584, 518, 586, 496, 608, 496, 608, 494, 610, 496, 608, 496, 608, 1600, 610, 1600, 608, 1600, 610, 518, 586, 494, 608, 1602, 608, 496, 686, 20172, 586, 496, 608, 494, 610, 518, 586, 496, 608, 498, 606, 498, 608, 496, 608, 520, 584, 496, 608, 496, 610, 494, 610, 496, 608, 496, 608, 518, 586, 494, 610, 520, 584, 496, 608, 494, 610, 496, 608, 496, 608, 1600, 608, 520, 584, 494, 610, 498, 606, 496, 608, 498, 606, 498, 606, 494, 610, 1598, 610, 1602, 608, 518, 586, 1600, 608 },  // KELVINATOR
  { 9054, 4442, 608, 1624, 584, 494, 610, 496, 608, 1600, 608, 1602, 608, 494, 608, 496, 608, 496, 608, 496, 608, 494, 610, 520, 584, 1624, 586, 498, 606, 518, 586, 496, 608, 518, 586, 496, 608, 494, 610, 494, 610, 496, 608, 518, 586, 1624, 586, 494, 610, 494, 610, 496, 606, 498, 608, 496, 608, 498, 606, 1600, 610, 520, 584, 1624, 584, 496, 608, 496, 608, 1602, 608, 518, 638, 20150, 606, 496, 608, 496, 608, 496, 608, 496, 608, 1602, 606, 494, 610, 518, 586, 494, 610, 494, 610, 518, 586, 518, 586, 496, 608, 494, 610, 1602, 608, 494, 608, 496, 608, 494, 610, 520, 584, 496, 608, 498, 606, 496, 608, 498, 606, 496, 608, 518, 586, 518, 586, 496, 608, 494, 610, 494, 610, 494, 610, 1600, 608, 1600, 608, 1602, 660, 40406, 9158, 4440, 610, 1602, 608, 496, 608, 496, 608, 1602, 608, 1600, 608, 494, 610, 494, 610, 494, 610, 496, 608, 518, 584, 496, 608, 1602, 608, 518, 584, 496, 608, 496, 608, 496, 608, 496, 608, 496, 608, 496, 608, 494, 610, 498, 606, 1600, 610, 494, 610, 518, 586, 494, 610, 518, 586, 494, 610, 496, 608, 1600, 608, 1600, 608, 1624, 584, 496, 608, 520, 584, 1600, 608, 520, 664, 20150, 608, 518, 584, 496, 608, 496, 608, 496, 608, 520, 584, 496, 608, 496, 608, 494, 610, 518, 586, 496, 608, 496, 608, 498, 606, 496, 608, 494, 610, 496, 608, 496, 608, 494, 610, 496, 608, 496, 606, 496, 608, 1624, 584, 496, 608, 496, 608, 520, 584, 496, 608, 496, 608, 498, 606, 496, 608, 520, 584, 494, 610, 1602, 608, 1600, 608 },       // KELVINATOR
  { 9040, 4454, 598, 1610, 598, 482, 622, 482, 622, 1586, 622, 1588, 620, 506, 598, 482, 622, 480, 624, 1588, 620, 482, 622, 482, 620, 1588, 622, 482, 622, 480, 622, 482, 622, 482, 622, 482, 622, 482, 622, 480, 624, 484, 620, 482, 622, 1586, 624, 480, 624, 506, 598, 480, 624, 482, 622, 480, 624, 482, 622, 1586, 622, 482, 622, 1610, 598, 482, 622, 480, 624, 1586, 624, 504, 652, 20134, 624, 504, 600, 504, 600, 480, 624, 482, 622, 1584, 624, 480, 624, 482, 622, 506, 598, 506, 600, 504, 598, 482, 622, 484, 620, 482, 622, 1610, 598, 484, 620, 484, 620, 482, 622, 480, 624, 480, 624, 482, 622, 482, 622, 484, 620, 482, 622, 506, 598, 480, 624, 482, 622, 484, 620, 506, 598, 1586, 624, 1610, 598, 1588, 620, 1586, 676, 40390, 9172, 4430, 620, 1588, 622, 480, 624, 482, 622, 1610, 598, 1588, 620, 482, 622, 482, 620, 506, 598, 1590, 620, 482, 620, 480, 624, 1610, 598, 482, 622, 484, 620, 484, 620, 484, 620, 484, 620, 484, 620, 484, 620, 484, 620, 482, 622, 1588, 620, 484, 620, 484, 620, 480, 622, 506, 598, 484, 620, 484, 620, 1588, 620, 1588, 620, 1588, 620, 482, 622, 482, 622, 1586, 624, 506, 676, 20136, 622, 506, 598, 482, 622, 482, 620, 506, 600, 480, 624, 484, 620, 482, 620, 484, 620, 506, 598, 482, 622, 482, 622, 482, 622, 482, 622, 482, 622, 506, 598, 482, 622, 506, 598, 480, 624, 482, 622, 480, 622, 1612, 598, 482, 622, 482, 622, 482, 622, 480, 624, 482, 622, 482, 622, 482, 624, 1586, 622, 484, 620, 1586, 622, 1610, 598 },   // KELVINATOR
  { 9048, 4446, 604, 1604, 604, 498, 606, 500, 604, 1606, 604, 1604, 604, 498, 606, 498, 606, 500, 604, 502, 604, 1606, 604, 498, 606, 1606, 604, 498, 604, 500, 604, 524, 580, 498, 606, 524, 582, 500, 604, 500, 604, 500, 604, 498, 606, 1604, 604, 500, 604, 502, 602, 502, 602, 500, 604, 498, 606, 500, 604, 1608, 602, 500, 604, 1628, 580, 502, 602, 500, 604, 1606, 602, 502, 656, 20152, 604, 498, 606, 524, 580, 500, 604, 524, 580, 1628, 580, 502, 602, 500, 604, 502, 602, 498, 606, 502, 602, 502, 602, 502, 602, 500, 604, 1604, 604, 502, 604, 500, 604, 498, 606, 500, 604, 500, 604, 502, 602, 500, 606, 500, 604, 500, 604, 500, 604, 502, 602, 500, 604, 500, 604, 522, 582, 500, 604, 500, 604, 500, 604, 522, 634, 40412, 9154, 4446, 604, 1604, 604, 498, 606, 500, 604, 1628, 582, 1604, 604, 500, 606, 500, 604, 500, 604, 500, 604, 1604, 604, 500, 604, 1604, 604, 500, 604, 500, 604, 502, 602, 500, 604, 500, 604, 500, 604, 500, 604, 502, 602, 500, 604, 1606, 604, 500, 604, 500, 604, 524, 580, 498, 606, 500, 602, 500, 604, 1606, 604, 1606, 604, 1604, 604, 500, 604, 500, 604, 1604, 604, 500, 684, 20154, 602, 500, 604, 498, 606, 500, 604, 522, 582, 500, 604, 502, 602, 502, 602, 498, 606, 500, 604, 500, 604, 500, 604, 498, 606, 500, 604, 500, 606, 498, 604, 500, 604, 500, 604, 502, 602, 500, 604, 500, 604, 1604, 604, 500, 604, 500, 604, 500, 604, 500, 604, 500, 604, 500, 604, 500, 604, 502, 602, 1604, 604, 1608, 602, 1604, 604 },
  { 9066, 4428, 624, 1586, 622, 482, 620, 484, 622, 1586, 624, 1586, 624, 482, 620, 480, 624, 484, 620, 1586, 624, 1586, 622, 482, 620, 1588, 622, 482, 622, 482, 622, 482, 622, 482, 622, 506, 598, 482, 622, 482, 622, 482, 622, 480, 624, 1586, 624, 480, 624, 504, 598, 482, 622, 484, 620, 482, 622, 482, 622, 1586, 622, 504, 600, 1588, 622, 482, 622, 482, 622, 1588, 622, 482, 674, 20136, 620, 480, 624, 482, 622, 482, 622, 482, 620, 1588, 622, 482, 622, 482, 622, 482, 622, 482, 622, 482, 622, 480, 624, 484, 620, 482, 622, 1588, 622, 482, 622, 484, 620, 482, 622, 482, 622, 482, 622, 482, 622, 484, 620, 482, 622, 482, 622, 480, 622, 482, 622, 480, 622, 484, 620, 506, 598, 1586, 622, 480, 624, 482, 622, 484, 672, 40392, 9172, 4428, 622, 1586, 622, 482, 622, 482, 622, 1586, 622, 1586, 622, 482, 622, 482, 622, 504, 600, 1586, 624, 1588, 620, 480, 624, 1586, 624, 482, 622, 480, 624, 482, 622, 482, 622, 484, 620, 482, 622, 482, 622, 506, 598, 482, 622, 1586, 622, 480, 624, 482, 622, 482, 622, 482, 622, 482, 622, 480, 622, 1588, 622, 1588, 622, 1586, 622, 482, 622, 484, 620, 1584, 624, 482, 700, 20136, 622, 482, 622, 482, 622, 482, 622, 482, 622, 482, 622, 482, 622, 482, 622, 482, 622, 482, 622, 480, 624, 480, 622, 482, 622, 482, 622, 480, 624, 480, 622, 482, 622, 482, 622, 480, 624, 482, 622, 484, 620, 1586, 622, 482, 622, 482, 622, 482, 622, 484, 620, 482, 622, 482, 622, 482, 622, 1588, 622, 1586, 622, 1588, 622, 1588, 622 },  // KELVINATOR
  { 9022, 4474, 618, 1590, 620, 486, 618, 486, 618, 1588, 620, 1590, 618, 486, 618, 486, 618, 486, 618, 486, 618, 508, 596, 1590, 620, 1592, 618, 486, 618, 488, 616, 484, 620, 484, 620, 484, 620, 486, 618, 486, 618, 486, 618, 484, 618, 1590, 620, 484, 620, 510, 594, 486, 618, 488, 616, 486, 618, 486, 618, 1590, 620, 486, 618, 1592, 618, 482, 620, 486, 618, 1590, 620, 510, 648, 20136, 620, 484, 618, 486, 618, 486, 618, 486, 618, 1590, 618, 486, 618, 484, 620, 484, 620, 486, 618, 486, 618, 484, 620, 486, 618, 486, 618, 1592, 616, 486, 618, 486, 618, 486, 618, 508, 596, 486, 618, 486, 618, 484, 618, 486, 620, 486, 618, 488, 616, 486, 618, 488, 616, 486, 618, 486, 618, 486, 618, 1590, 620, 486, 618, 510, 648, 40396, 9126, 4474, 618, 1592, 618, 484, 620, 486, 618, 1590, 618, 1590, 620, 484, 618, 486, 618, 486, 618, 488, 616, 486, 618, 1590, 618, 1590, 620, 486, 618, 486, 620, 486, 618, 486, 618, 486, 618, 488, 616, 486, 618, 484, 620, 486, 618, 1592, 618, 484, 620, 508, 596, 486, 618, 486, 618, 486, 616, 486, 618, 1594, 616, 1590, 618, 1614, 594, 488, 616, 508, 596, 1590, 620, 486, 696, 20162, 596, 486, 618, 486, 618, 510, 594, 486, 618, 486, 618, 486, 618, 486, 618, 486, 618, 484, 620, 486, 620, 484, 618, 486, 618, 486, 618, 486, 618, 486, 618, 486, 618, 484, 620, 484, 620, 486, 618, 486, 618, 1592, 618, 488, 616, 486, 618, 488, 616, 486, 618, 486, 618, 488, 616, 486, 618, 488, 616, 488, 616, 488, 616, 486, 618 },        // KELVINATOR
  { 9022, 4474, 576, 1632, 616, 488, 576, 528, 578, 1634, 574, 1634, 576, 528, 576, 528, 576, 528, 576, 1630, 580, 528, 576, 1656, 552, 1634, 576, 528, 576, 526, 578, 526, 578, 526, 578, 528, 576, 528, 576, 526, 576, 528, 576, 528, 576, 1634, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 1632, 576, 528, 576, 1632, 576, 530, 574, 530, 574, 1632, 576, 530, 628, 20180, 576, 528, 576, 528, 576, 528, 578, 526, 576, 1632, 576, 526, 578, 526, 578, 528, 576, 528, 576, 550, 552, 528, 578, 526, 576, 528, 576, 1636, 574, 552, 552, 526, 578, 550, 554, 528, 576, 528, 576, 530, 574, 528, 576, 528, 576, 528, 576, 528, 576, 528, 578, 526, 576, 528, 576, 528, 576, 1632, 576, 1632, 578, 528, 576, 526, 630, 40438, 9126, 4474, 576, 1632, 576, 528, 576, 526, 578, 1634, 576, 1634, 574, 526, 578, 528, 576, 528, 578, 1632, 576, 526, 578, 1632, 576, 1634, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 1634, 576, 526, 578, 528, 576, 528, 576, 526, 576, 528, 576, 528, 576, 1634, 576, 1632, 578, 1632, 578, 530, 574, 526, 578, 1634, 574, 528, 654, 20178, 616, 490, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 530, 574, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 526, 578, 528, 576, 528, 576, 528, 576, 1632, 576, 530, 574, 528, 576, 528, 576, 528, 576, 528, 576, 526, 578, 526, 578, 1634, 576, 526, 578, 528, 576, 528, 578 },    // KELVINATOR
  { 9046, 4448, 576, 1632, 578, 530, 576, 530, 574, 1632, 578, 1634, 574, 528, 576, 528, 576, 530, 574, 526, 578, 1634, 574, 1634, 576, 1634, 574, 528, 576, 528, 576, 528, 576, 528, 576, 526, 578, 550, 552, 552, 552, 530, 574, 552, 552, 1634, 574, 528, 576, 526, 578, 526, 578, 550, 554, 530, 574, 528, 576, 1634, 576, 528, 576, 1632, 576, 526, 578, 528, 576, 1656, 552, 528, 628, 20178, 576, 526, 578, 528, 576, 526, 578, 526, 578, 1632, 576, 528, 576, 528, 574, 528, 578, 528, 576, 526, 578, 528, 576, 528, 574, 528, 576, 1634, 574, 528, 576, 526, 578, 526, 578, 526, 578, 526, 578, 526, 578, 528, 576, 528, 576, 528, 576, 528, 576, 552, 552, 530, 574, 552, 552, 528, 576, 528, 576, 528, 576, 1634, 576, 526, 630, 40436, 9152, 4452, 574, 1632, 576, 528, 576, 528, 576, 1634, 576, 1632, 576, 528, 578, 528, 576, 530, 574, 526, 578, 1634, 574, 1634, 576, 1632, 578, 528, 576, 526, 578, 526, 578, 528, 576, 528, 576, 526, 578, 528, 578, 526, 576, 528, 576, 1634, 576, 528, 576, 528, 576, 526, 578, 528, 576, 528, 576, 528, 576, 1634, 576, 1632, 576, 1632, 576, 528, 576, 528, 576, 1632, 578, 528, 656, 20178, 576, 528, 576, 530, 574, 528, 576, 528, 576, 528, 576, 528, 576, 528, 576, 530, 574, 528, 576, 526, 576, 528, 578, 526, 576, 528, 578, 528, 576, 552, 552, 526, 578, 530, 574, 528, 576, 528, 576, 526, 578, 1632, 576, 526, 576, 530, 574, 528, 576, 528, 576, 552, 552, 528, 576, 526, 578, 526, 578, 1632, 578, 526, 578, 528, 576 }      // KELVINATOR
};
uint16_t power_on[279] = { 9054, 4442, 608, 1624, 584, 494, 610, 496, 608, 1600, 608, 1602, 608, 494, 608, 496, 608, 496, 608, 496, 608, 494, 610, 520, 584, 1624, 586, 498, 606, 518, 586, 496, 608, 518, 586, 496, 608, 494, 610, 494, 610, 496, 608, 518, 586, 1624, 586, 494, 610, 494, 610, 496, 606, 498, 608, 496, 608, 498, 606, 1600, 610, 520, 584, 1624, 584, 496, 608, 496, 608, 1602, 608, 518, 638, 20150, 606, 496, 608, 496, 608, 496, 608, 496, 608, 1602, 606, 494, 610, 518, 586, 494, 610, 494, 610, 518, 586, 518, 586, 496, 608, 494, 610, 1602, 608, 494, 608, 496, 608, 494, 610, 520, 584, 496, 608, 498, 606, 496, 608, 498, 606, 496, 608, 518, 586, 518, 586, 496, 608, 494, 610, 494, 610, 494, 610, 1600, 608, 1600, 608, 1602, 660, 40406, 9158, 4440, 610, 1602, 608, 496, 608, 496, 608, 1602, 608, 1600, 608, 494, 610, 494, 610, 494, 610, 496, 608, 518, 584, 496, 608, 1602, 608, 518, 584, 496, 608, 496, 608, 496, 608, 496, 608, 496, 608, 496, 608, 494, 610, 498, 606, 1600, 610, 494, 610, 518, 586, 494, 610, 518, 586, 494, 610, 496, 608, 1600, 608, 1600, 608, 1624, 584, 496, 608, 520, 584, 1600, 608, 520, 664, 20150, 608, 518, 584, 496, 608, 496, 608, 496, 608, 520, 584, 496, 608, 496, 608, 494, 610, 518, 586, 496, 608, 496, 608, 498, 606, 496, 608, 494, 610, 496, 608, 496, 608, 494, 610, 496, 608, 496, 606, 496, 608, 1624, 584, 496, 608, 496, 608, 520, 584, 496, 608, 496, 608, 498, 606, 496, 608, 520, 584, 494, 610, 1602, 608, 1600, 608 };  // 24
uint16_t power_off[279] = { 9052, 4442, 608, 1602, 606, 496, 608, 494, 610, 496, 608, 1624, 584, 496, 608, 496, 606, 498, 606, 522, 582, 1602, 606, 498, 606, 1602, 608, 498, 606, 496, 608, 498, 606, 498, 606, 498, 606, 494, 610, 498, 606, 496, 608, 496, 606, 1604, 606, 498, 606, 498, 606, 498, 606, 496, 608, 520, 584, 498, 606, 1604, 606, 498, 606, 1604, 606, 520, 584, 498, 606, 1602, 608, 496, 660, 20148, 608, 496, 608, 498, 606, 496, 608, 498, 606, 520, 584, 496, 608, 520, 584, 496, 608, 498, 604, 498, 606, 520, 584, 496, 608, 520, 584, 1602, 606, 520, 584, 496, 608, 498, 606, 498, 606, 496, 608, 496, 608, 498, 606, 498, 606, 496, 608, 496, 608, 500, 604, 498, 606, 500, 604, 496, 608, 1602, 606, 1604, 606, 1602, 606, 498, 658, 40406, 9158, 4444, 606, 1604, 606, 498, 606, 496, 608, 520, 584, 1626, 584, 498, 606, 498, 606, 496, 608, 498, 606, 1600, 608, 496, 608, 1602, 608, 498, 606, 498, 608, 496, 608, 498, 606, 496, 608, 520, 584, 496, 608, 496, 608, 498, 606, 1602, 606, 498, 606, 520, 584, 496, 608, 496, 608, 498, 606, 520, 584, 1602, 606, 1602, 608, 1624, 584, 498, 606, 496, 608, 1600, 608, 498, 686, 20150, 608, 496, 608, 498, 606, 496, 608, 496, 608, 494, 610, 496, 608, 520, 584, 498, 606, 520, 584, 520, 584, 496, 608, 496, 606, 496, 608, 498, 606, 520, 584, 496, 608, 520, 584, 496, 608, 520, 584, 496, 608, 1602, 608, 498, 606, 496, 608, 496, 608, 498, 606, 496, 608, 520, 584, 520, 584, 498, 606, 1602, 606, 1626, 584, 520, 584 };  // KELVINATOR

void setup() {
  Serial.begin(115200);
  irsend.begin();
  // 设置开发板网络环境
  if (!WiFi.config(local_IP, gateway, subnet)) {
    Serial.println("Failed to Config ESP8266 IP");
  }
  wifiMulti.addAP(ssid, password);
  int i = 0;
  while (wifiMulti.run() != WL_CONNECTED) {  // 此处的wifiMulti.run()是重点。通过wifiMulti.run()，NodeMCU将会在当前
    delay(1000);                             // 环境中搜索addAP函数所存储的WiFi。如果搜到多个存储的WiFi那么NodeMCU
    Serial.print(i++);
    Serial.print(' ');  // 将会连接信号最强的那一个WiFi信号。
  }                     // 一旦连接WiFI成功，wifiMulti.run()将会返回“WL_CONNECTED”。这也是
                        // 此处while循环判断是否跳出循环的条件。
  // WiFi连接成功后将通过串口监视器输出连接成功信息
  Serial.println('\n');            // WiFi连接成功后
  Serial.print("Connected to ");   // NodeMCU将通过串口监视器输出。
  Serial.println(WiFi.SSID());     // 连接的WiFI名称
  Serial.print("IP address:\t");   // 以及
  Serial.println(WiFi.localIP());  // NodeMCU的IP地址

  server.on("/", handleRoot);
  server.on("/16", []() {
    handleTemperature(16);
  });
  server.on("/17", []() {
    handleTemperature(17);
  });
  server.on("/18", []() {
    handleTemperature(18);
  });
  server.on("/19", []() {
    handleTemperature(19);
  });
  server.on("/20", []() {
    handleTemperature(20);
  });
  server.on("/21", []() {
    handleTemperature(21);
  });
  server.on("/22", []() {
    handleTemperature(22);
  });
  server.on("/23", []() {
    handleTemperature(23);
  });
  server.on("/24", []() {
    handleTemperature(24);
  });
  server.on("/25", []() {
    handleTemperature(25);
  });
  server.on("/26", []() {
    handleTemperature(26);
  });
  server.on("/27", []() {
    handleTemperature(27);
  });
  server.on("/28", []() {
    handleTemperature(28);
  });
  server.on("/29", []() {
    handleTemperature(29);
  });
  server.on("/30", []() {
    handleTemperature(30);
  });
  server.on("/poweroff", handlePowerOff);
  server.on("/poweron", handlePowerOn);

  server.begin();
  Serial.println("HTTP server started");
}

void loop() {
  server.handleClient();
}

void handleRoot() {
  server.send(200, "text/html", getHtml());
}

String getHtml() {
  return String(
    "<!DOCTYPE html>"
    "<html lang=\"zh-CN\">"
    "<head>"
    "<meta charset=\"UTF-8\">"
    "<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">"
    "<title>空调遥控器</title>"
    "<style>"
    "body {"
    "font-family: Arial, sans-serif;"
    "display: flex;"
    "justify-content: center;"
    "align-items: center;"
    "height: 100vh;"
    "background: url('background.jpg') no-repeat center center fixed;"
    "background-size: cover;"
    "margin: 0;"
    "}"
    ".remote-control {"
    "background: rgba(255, 255, 255, 0.7);"
    "padding: 20px;"
    "border-radius: 15px;"
    "box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);"
    "text-align: center;"
    "backdrop-filter: blur(10px);"
    "position: relative;"
    "}"
    ".temperature-display {"
    "font-size: 2em;"
    "margin-bottom: 20px;"
    "color: #333;"
    "transition: opacity 0.3s ease;"
    "opacity: 1;"
    "}"
    ".temperature-display.transparent {"
    "opacity: 0.2;"
    "}"
    "input[type=\"range\"] {"
    "-webkit-appearance: none;"
    "width: 100%;"
    "height: 8px;"
    "border-radius: 5px;"
    "background: linear-gradient(to right, #4CAF50, #45a049);"
    "outline: none;"
    "opacity: 0.7;"
    "transition: opacity .15s ease-in-out;"
    "}"
    "input[type=\"range\"]:hover {"
    "opacity: 1;"
    "}"
    "input[type=\"range\"]::-webkit-slider-thumb {"
    "-webkit-appearance: none;"
    "appearance: none;"
    "width: 25px;"
    "height: 25px;"
    "border-radius: 50%;"
    "background: #4CAF50;"
    "cursor: pointer;"
    "box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);"
    "transition: background 0.3s ease;"
    "}"
    "input[type=\"range\"]::-webkit-slider-thumb:hover {"
    "background: #45a049;"
    "}"
    ".button-group {"
    "display: flex;"
    "justify-content: space-between;"
    "}"
    ".button {"
    "background: #4CAF50;"
    "border: none;"
    "color: white;"
    "padding: 10px 20px;"
    "text-align: center;"
    "text-decoration: none;"
    "display: inline-block;"
    "font-size: 16px;"
    "margin: 4px 2px;"
    "cursor: pointer;"
    "border-radius: 5px;"
    "transition: background-color 0.3s ease;"
    "}"
    ".button:hover {"
    "background-color: #45a049;"
    "}"
    ".button.off {"
    "background: #f44336;"
    "}"
    ".button.off:hover {"
    "background-color: #e53935;"
    "}"
    ".anime-character {"
    "position: absolute;"
    "bottom: -20px;"
    "right: -20px;"
    "width: 100px;"
    "}"
    ".feedback {"
    "margin-top: 20px;"
    "font-size: 1.2em;"
    "color: #333;"
    "opacity: 0;"
    "transition: opacity 0.3s ease;"
    "}"
    ".feedback.visible {"
    " opacity: 1;"
    "}"
    "</style>"
    "</head>"
    "<body>"
    "<div class=\"remote-control\">"
    "<div class=\"temperature-display transparent\" id=\"temperatureDisplay\">24°C</div>"
    "<input type=\"range\" id=\"temperatureRange\" min=\"16\" max=\"30\" value=\"24\" oninput=\"updateTemperatureDisplay()\">"
    "<div class=\"button-group\">"
    "<button class=\"button off\" onclick=\"sendRequest('poweroff')\">关闭</button>"
    "<button class=\"button\" onclick=\"sendRequest('poweron')\">开启</button>"
    "</div>"
    "<div class=\"feedback\" id=\"feedbackMessage\">"
    "</div>"
    "</div>"

    "<script>"
    "function updateTemperatureDisplay() {"
    "var temperature = document.getElementById('temperatureRange').value;"
    "document.getElementById('temperatureDisplay').innerText = temperature + '°C';"
    "}"
    "function sendRequest(action) {"
    "var baseUrl = '/';"
    "var url;"
    "var temperatureDisplay = document.getElementById('temperatureDisplay');"
    "var feedbackMessage = document.getElementById('feedbackMessage');"
    "if (action === 'poweron' || action === 'poweroff') {"
    "url = baseUrl + action;"
    "if (action === 'poweroff') {"
    "temperatureDisplay.classList.add('transparent');"
    "} else {"
    "temperatureDisplay.classList.remove('transparent');"
    "}"
    "} else {"
    "var temperature = document.getElementById('temperatureRange').value;"
    "url = baseUrl + temperature;"
    "temperatureDisplay.classList.remove('transparent');"
    "}"
    "fetch(url)"
    ".then(response => {"
    "if (response.ok) {"
    "feedbackMessage.innerText = '温度:'+temperature+'°C';"
    "} else {"
    "feedbackMessage.innerText = '设置失败';"
    "}"
    "feedbackMessage.classList.add('visible');"
    "setTimeout(() => feedbackMessage.classList.remove('visible'), 3000);"
    " })"
    ".catch(error => {"
    "feedbackMessage.innerText = '[请求出错!!!]';"
    "feedbackMessage.classList.add('visible');"
    "setTimeout(() => feedbackMessage.classList.remove('visible'), 3000);"
    "});"
    "}"
    "document.getElementById('temperatureRange').addEventListener('change', function() {"
    "sendRequest('temperature');"
    "});"
    "</script>"
    "</body>"
    "</html>");
}

void handleTemperature(int temperature) {
  // 这里插入控制空调温度的代码
  irsend.sendRaw(code[temperature - 16], 279, 38);  // Send a raw data capture at 38kHz.
  Serial.print("Setting temperature to ");
  Serial.println(temperature);
  server.send(200, "text/plain", "Temperature set to " + String(temperature));
}

void handlePowerOff() {
  // 这里插入关闭空调的代码
  irsend.sendRaw(power_off, 279, 38);  // Send a raw data capture at 38kHz.
  Serial.println("Power off");
  server.send(200, "text/plain", "Power off");
}

void handlePowerOn() {
  // 这里插入打开空调的代码
  irsend.sendRaw(power_on, 279, 38);  // Send a raw data capture at 38kHz.
  Serial.println("Power on");
  server.send(200, "text/plain", "Power on");
}
